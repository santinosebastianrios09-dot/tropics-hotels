<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Tropics Hotel ‚Äì Reservas</title>

    <!-- Logo como favicon (opcional) -->
    <link rel="icon" href="img/logo-tropics.jpg" />
    <link rel="stylesheet" href="chat-widget.css" />

    <!-- Estilos/animaciones del CHAT (solo visual) -->
    <link rel="stylesheet" href="visual/chat-visual.css" />
    <script defer src="visual/chat-visual.js"></script>

    <style>
      :root { --brand:#123; --accent:#14b8a6; --jade:#00a86b; --jade2:#16c38a; }
      * { box-sizing:border-box; }

      /* ‚úÖ Fondo con TU nueva imagen (√∫nico cambio) */
      body {
        margin:0;
        font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
        color:#1d1d1f;

        background-image: url('img/bg-gray.jpg'); /* <-- NUEVO FONDO */
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        background-attachment: fixed;
      }

      header { padding:20px 24px; border-bottom:1px solid #eee; position:sticky; top:0; background:#fff; z-index:5; display:flex; align-items:center; justify-content:space-between; }
      header .brand { display:flex; align-items:center; gap:10px; font-weight:800; letter-spacing:.3px; color:var(--brand); }
      /* üî∏ logo clickeable (ampliaci√≥n en lightbox) */
      header .brand img { width:28px; height:28px; border-radius:6px; object-fit:cover; cursor:zoom-in; }

      .container { max-width:1100px; margin:0 auto; padding:24px; }

      .hero { display:grid; grid-template-columns:1.4fr 1fr; gap:24px; align-items:center; margin-top:8px; }
      .card { border:1px solid #eee; border-radius:14px; overflow:hidden; box-shadow:0 10px 20px rgba(0,0,0,.06); background:#fff; }
      .hero img { display:block; width:100%; height:360px; object-fit:cover; }
      .hero .copy { padding:16px 18px; }

      .rooms { margin-top:28px; }
      .rooms h2 { margin:0 0 12px; }
      .grid { display:grid; grid-template-columns:repeat(3, 1fr); gap:16px; }
      .room { position:relative; border:1px solid #eee; border-radius:12px; overflow:hidden; box-shadow:0 6px 14px rgba(0,0,0,.05); background:#fff; }
      .img-wrap { position:relative; cursor:pointer; }
      .img-wrap img { width:100%; height:200px; object-fit:cover; display:block; position:relative; z-index:1; }

      /* Overlay sobre la imagen (recibe clics) */
      .overlay {
        position:absolute; left:10px; right:10px; bottom:10px;
        display:flex; gap:8px; align-items:center; justify-content:space-between;
        z-index:2;
      }
      .badge-price {
        background:rgba(255,255,255,.92); color:#111;
        padding:6px 10px; border-radius:10px; font-weight:600; font-size:12px;
        backdrop-filter:saturate(1.2) blur(3px);
      }

      /* ===== Bot√≥n ‚Äú¬°Reserv√° ya!‚Äù (SOLO DISE√ëO) ===== */
      .btn-reserve {
        border:none; cursor:pointer;
        /* ‚úÖ degrad√© jade para m√°s presencia */
        background: linear-gradient(135deg, var(--jade), var(--jade2));
        color:#fff; font-weight:800; font-size:12px;
        padding:9px 14px; border-radius:999px;
        box-shadow: 0 8px 18px rgba(0,168,107,.35), inset 0 -1px 0 rgba(255,255,255,.25);
        transition: transform .16s ease, box-shadow .2s ease, filter .15s ease;
        position: relative; overflow: hidden;
      }
      /* ‚Äúlevitaci√≥n‚Äù y brillo */
      .btn-reserve:hover{
        transform: translateY(-2px);
        box-shadow: 0 12px 26px rgba(0,168,107,.45), inset 0 -1px 0 rgba(255,255,255,.3);
        filter: brightness(1.03);
      }
      .btn-reserve:active{
        transform: translateY(0);
        filter: saturate(1.06);
      }
      /* Efecto ‚Äúshine‚Äù sutil al pasar el mouse */
      .btn-reserve::before{
        content:"";
        position:absolute; top:-50%; left:-20%;
        width:40%; height:200%;
        transform: rotate(25deg);
        background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,.45) 50%, rgba(255,255,255,0) 100%);
        opacity:0; pointer-events:none;
        transition: opacity .25s ease, left .6s ease;
      }
      .btn-reserve:hover::before{
        opacity:.9; left:120%;
      }

      .room .meta { padding:10px 12px; font-size:14px; display:flex; justify-content:space-between; align-items:center;}
      .pill { background:#f4f4f6; padding:4px 8px; border-radius:999px; font-size:12px; }

      /* üîπ Acciones bajo el nombre de la habitaci√≥n */
      .room-actions { display:flex; gap:8px; align-items:center; padding:0 12px 12px 12px; }
      .btn-secondary{
        border:1px solid #e5e7eb; background:#fff; color:#111; font-weight:600; font-size:12px;
        padding:8px 12px; border-radius:10px; cursor:pointer;
      }
      .btn-secondary:hover{ background:#f9fafb; }

      /* ==== Carrusel gen√©rico (hero & lobby) ==== */
      .slider { position:relative; }
      .slider .slide { width:100%; height:360px; object-fit:cover; display:block; }
      .slider .nav {
        position:absolute; top:50%; transform:translateY(-50%);
        background:rgba(0,0,0,.45); color:#fff; border:0; width:36px; height:36px;
        border-radius:999px; cursor:pointer; display:flex; align-items:center; justify-content:center;
      }
      .slider .prev { left:10px; }
      .slider .next { right:10px; }
      .slider .nav:hover { background:rgba(0,0,0,.6); }
      .slider .dots { position:absolute; left:0; right:0; bottom:10px; display:flex; gap:6px; justify-content:center; }
      .slider .dot { width:8px; height:8px; border-radius:999px; background:rgba(255,255,255,.7); border:1px solid rgba(0,0,0,.12); }
      .slider .dot.active { background:#fff; }

      /* üîñ Etiquetas sobre las fotos */
      .slider .tag-badge{
        position:absolute; top:10px; left:12px;
        padding:6px 10px; border-radius:10px;
        background:rgba(0,0,0,.55); color:#fff; font-weight:700; font-size:12px;
        letter-spacing:.2px; z-index:3; backdrop-filter:saturate(1.2) blur(2px);
      }

      /* ==== Lightbox ==== */
      .lightbox{
        position:fixed; inset:0; display:none;
        align-items:center; justify-content:center;
        background:rgba(10,12,16,.65);
        backdrop-filter:blur(4px);
        z-index:50;
      }
      .lightbox.open{ display:flex; }
      .lightbox .inner{
        position:relative; max-width:92vw; max-height:92vh;
        border-radius:14px; overflow:hidden; box-shadow:0 20px 45px rgba(0,0,0,.35);
        /* üü¢ CAMBIO: blanco para evitar franjas negras */
        background:#fff;
      }
      .lightbox img{
        display:block;
        /* üü¢ CAMBIO: ocupa todo el ancho disponible sin deformar */
        width:100%; height:auto;
        max-width:92vw; max-height:70vh;
        object-fit:contain;
        background:#fff; /* fondo blanco para evitar bordes oscuros */
      }
      .lightbox .close{
        position:absolute; top:10px; right:10px;
        background:rgba(0,0,0,.6); color:#fff; border:0; width:36px; height:36px;
        border-radius:999px; cursor:pointer; font-size:18px; line-height:36px; text-align:center;
      }
      .lightbox .close:hover{ background:rgba(0,0,0,.8); }

      /* üîπ Panel de descripci√≥n bajo la imagen del lightbox */
      .lightbox .caption{
        background:#fff; color:#111;
        padding:14px 16px; border-top:1px solid #111;
      }
      .lightbox .caption h3{ margin:0 0 6px; font-size:16px; }
      .lightbox .caption p{ margin:0; font-size:14px; line-height:1.45; }

      @media (max-width:1024px){ .hero{ grid-template-columns:1fr; } }
      @media (max-width:680px){ .grid{ grid-template-columns:1fr; } .slider .slide{ height:260px; } }

      /* ================================
         üü¢ NUEVO: Bot√≥n fijo "Comenzar simulaci√≥n"
         ================================ */
      #simulate-fab{
        position:fixed;
        left:50%;
        bottom:16px;
        transform:translateX(-50%);
        z-index:2147481000; /* por debajo del panel del chat (2147483000) */
        text-decoration:none;
        font-weight:900;
        font-size:14px;
        padding:12px 18px;
        border-radius:999px;
        color:#fff;
        /* üåå Azul gal√°ctico con toque morado */
        background:linear-gradient(135deg, #3b82f6, #9333ea);
        box-shadow:0 8px 20px rgba(59,130,246,.35), inset 0 -1px 0 rgba(255,255,255,.25);
        border:0;
        display:inline-flex;
        align-items:center;
        justify-content:center;
        gap:8px;
        animation: simPulse 2.2s ease-in-out infinite;
        user-select:none;
      }
      #simulate-fab:hover{
        filter:brightness(1.05);
        transform:translateX(-50%) translateY(-2px);
        box-shadow:0 12px 28px rgba(59,130,246,.45), inset 0 -1px 0 rgba(255,255,255,.3);
      }
      #simulate-fab:active{ transform:translateX(-50%) translateY(0); }
      @keyframes simPulse{
        0%{ box-shadow:0 8px 20px rgba(59,130,246,.35), 0 0 0 0 rgba(59,130,246,0.25); }
        70%{ box-shadow:0 8px 20px rgba(59,130,246,.35), 0 0 0 14px rgba(59,130,246,0); }
        100%{ box-shadow:0 8px 20px rgba(59,130,246,.35), 0 0 0 0 rgba(59,130,246,0); }
      }
      @media (max-width: 720px){
        #simulate-fab{
          bottom:12px;
          font-size:13px;
          padding:11px 16px;
        }
      }

      /* ================================
         üü¢ NUEVO: Bot√≥n hamburguesa + Drawer de Pol√≠ticas
         ================================ */
      .hamburger-btn{
        display:inline-flex;
        align-items:center;
        justify-content:center;
        width:36px; height:36px;
        border-radius:10px;
        border:1px solid #e5e7eb;
        background:#fff; color:#111;
        cursor:pointer;
        margin-right:10px;
      }
      .hamburger-btn:focus{ outline:2px solid #3b82f6; outline-offset:2px; }
      .hamburger-lines{
        width:18px; height:14px; position:relative;
      }
      .hamburger-lines::before,
      .hamburger-lines::after,
      .hamburger-lines span{
        content:"";
        position:absolute; left:0; right:0; height:2px; background:#111; border-radius:2px;
      }
      .hamburger-lines::before{ top:0; }
      .hamburger-lines span{ top:6px; }
      .hamburger-lines::after{ bottom:0; }

      /* Drawer */
      #policy-backdrop{
        position:fixed; inset:0; background:rgba(10,12,16,.55);
        backdrop-filter: blur(2px);
        display:none; z-index:2147481500; /* debajo del chat */
      }
      #policy-backdrop.open{ display:block; }

      #policy-drawer{
        position:fixed; top:0; left:0; bottom:0;
        width:380px; max-width:92vw;
        background:#fff; color:#111;
        box-shadow: 0 18px 48px rgba(0,0,0,.28);
        transform: translateX(-100%);
        transition: transform .25s ease;
        z-index:2147481600; /* debajo del chat */
        display:flex; flex-direction:column;
      }
      #policy-drawer.open{ transform: translateX(0); }

      #policy-drawer header{
        display:flex; align-items:center; justify-content:space-between;
        padding:14px 16px; border-bottom:1px solid #eee;
      }
      #policy-drawer header h2{ font-size:16px; margin:0; }
      #policy-close{
        width:32px; height:32px; border-radius:8px; border:1px solid #e5e7eb; background:#fff; cursor:pointer;
      }
      #policy-body{
        padding:8px 0 12px 0; overflow:auto;
      }

      /* (estilos viejos del acorde√≥n se dejan por compatibilidad) */
      .accordion { padding:8px 12px 16px; }
      .accordion details{ border-bottom:1px solid #eee; padding:6px 0; }
      .accordion summary{ cursor:pointer; list-style:none; font-weight:700; padding:8px 6px; border-radius:8px; }
      .accordion summary::-webkit-details-marker{ display:none; }
      .accordion summary:focus{ outline:2px solid #3b82f6; outline-offset:2px; }
      .accordion .panel{ padding:0 6px 12px 6px; font-size:14px; line-height:1.5; }

      /* ================================
         üü¢ NUEVO: Lista de t√≠tulos + Modal (panel)
         ================================ */
      .plist{ padding:8px 12px 16px; display:grid; gap:10px; }
      .pitem{
        display:flex; align-items:center; justify-content:space-between; width:100%;
        border:1px solid #e5e7eb; border-radius:12px; background:#fff; padding:10px 12px;
        cursor:pointer; transition: box-shadow .15s ease, transform .03s ease;
      }
      .pitem:hover{ box-shadow:0 6px 16px rgba(0,0,0,.06) }
      .pitem:active{ transform: translateY(1px) }
      .pitem .ptitle{ font-weight:800; font-size:14px; color:#111; }
      .pitem .badge{ font-size:11px; font-weight:700; color:#374151; background:#f3f4f6; border:1px solid #e5e7eb; border-radius:999px; padding:2px 8px; }

      /* Modal dentro del drawer */
      #policy-modal-backdrop{
        position:fixed; inset:0; background:rgba(10,12,16,.55); backdrop-filter: blur(2px);
        display:none; z-index:2147481650; /* por encima del drawer y por debajo del chat */
      }
      #policy-modal-backdrop.open{ display:block; }

      #policy-modal{
        position:fixed; left:50%; top:4vh; transform:translateX(-50%);
        width:min(820px, 94vw); max-height:92vh; overflow:auto;
        background:#fff; border:1px solid #e5e7eb; border-radius:14px;
        box-shadow: 0 20px 48px rgba(0,0,0,.28); z-index:2147481660; display:none;
      }
      #policy-modal.open{ display:block; }
      #policy-modal header{
        position:sticky; top:0; background:#fff; border-bottom:1px solid #eee;
        display:flex; align-items:center; justify-content:space-between; padding:12px 14px; z-index:1;
      }
      #policy-modal header h3{ margin:0; font-size:16px; }
      #policy-modal header button{
        width:34px; height:34px; border-radius:8px; border:1px solid #e5e7eb; background:#fff; cursor:pointer;
      }
      #policy-modal .content{ padding:14px; font-size:14px; line-height:1.55; }
      #policy-modal .content p{ margin:0 0 10px 0 }
      #policy-modal .content ul{ margin:8px 0 12px 18px }
      #policy-modal .content li{ margin:4px 0 }
      .policy-hint{ padding:4px 12px 0; font-size:12px; color:#6b7280; }
    </style>
  </head>
  <body>
    <header class="container">
      <div style="display:flex; align-items:center; gap:10px;">
        <!-- üü¢ NUEVO: Bot√≥n hamburguesa (superior izquierdo) -->
        <button id="policy-btn" class="hamburger-btn" aria-label="Abrir pol√≠ticas y privacidad" aria-controls="policy-drawer" aria-expanded="false">
          <span class="hamburger-lines"><span></span></span>
        </button>

        <div class="brand">
          <img id="logoImage" src="img/logo-tropics.jpg" alt="Logo" onerror="this.style.display='none'">
          Tropics Hotel
        </div>
      </div>
    </header>

    <main class="container">
      <section class="hero">
        <!-- ====== HERO / IZQUIERDA (Hotel) ====== -->
        <div class="card">
          <div class="slider" id="slider-hero" aria-label="Galer√≠a del hotel">
            <span class="tag-badge">Hotel</span>
            <img class="slide" id="hero-img" src="" alt="Hotel" />
            <button class="nav prev" type="button" aria-label="Anterior" id="hero-prev">‚Äπ</button>
            <button class="nav next" type="button" aria-label="Siguiente" id="hero-next">‚Ä∫</button>
            <div class="dots" id="hero-dots" aria-hidden="true"></div>
          </div>
          <div class="copy">
            <h1>Descans√° frente a la brisa del Oc√©ano √çndico.</h1>
            <p>Habitaciones luminosas, piscina al aire libre, almuerzo y desayuno tropical. Consult√° disponibilidad o reserv√° por el chat de la derecha: Asistente personal.</p>
            <p class="pill">Atenci√≥n 24/7 ¬∑ Confirmaci√≥n instant√°nea</p>
          </div>
        </div>

        <!-- ====== LOBBY / DERECHA ====== -->
        <div class="card">
          <div class="slider" id="slider-lobby" aria-label="Galer√≠a del lobby">
            <span class="tag-badge">Lobby</span>
            <img class="slide" id="lobby-img" src="" alt="Lobby" />
            <button class="nav prev" type="button" aria-label="Anterior" id="lobby-prev">‚Äπ</button>
            <button class="nav next" type="button" aria-label="Siguiente" id="lobby-next">‚Ä∫</button>
            <div class="dots" id="lobby-dots" aria-hidden="true"></div>
          </div>
        </div>
      </section>

      <!-- === HABITACIONES DIN√ÅMICAS DESDE GOOGLE SHEETS === -->
      <section class="rooms">
        <h2>Nuestras habitaciones</h2>
        <div id="rooms-grid" class="grid" aria-live="polite"></div>

        <!-- Plantilla de tarjeta -->
        <template id="room-card-template">
          <article class="room">
            <div class="img-wrap" role="button" tabindex="0" aria-label="Seleccionar habitaci√≥n">
              <img src="" alt="" loading="lazy" />
              <div class="overlay">
                <span class="badge-price"></span>
                <button class="btn-reserve" type="button" aria-label="Reservar esta habitaci√≥n">¬°Reserv√° ya!</button>
              </div>
            </div>
            <div class="meta">
              <strong class="room-name"></strong>
              <span class="pill room-price"></span>
            </div>
            <!-- üîπ NUEVO: acciones bajo el nombre -->
            <div class="room-actions">
              <button class="btn-secondary btn-view" type="button" aria-label="Ver habitaci√≥n">Ver habitaci√≥n</button>
            </div>
          </article>
        </template>

        <p id="rooms-error" style="display:none; color:#b91c1c; font-size:14px; margin-top:8px;">
          No se pudo cargar el cat√°logo de habitaciones.
        </p>
      </section>
    </main>

    <!-- üîµ NUEVO: Backdrop + Drawer de Pol√≠ticas con lista din√°mica -->
    <div id="policy-backdrop" aria-hidden="true"></div>
    <aside id="policy-drawer" role="dialog" aria-label="Pol√≠ticas y privacidad" aria-modal="true">
      <header>
        <h2>Pol√≠ticas y privacidad</h2>
        <button id="policy-close" aria-label="Cerrar panel">‚úï</button>
      </header>

      <div id="policy-body">
        <p class="policy-hint">Toc√° un t√≠tulo para ver su informaci√≥n.</p>
        <!-- Lista din√°mica de t√≠tulos del PDF (extra√≠dos desde politicas.html) -->
        <div id="policy-list" class="plist" role="list"></div>
      </div>
    </aside>

    <!-- Modal (dentro del panel) -->
    <div id="policy-modal-backdrop" aria-hidden="true"></div>
    <article id="policy-modal" role="dialog" aria-modal="true" aria-labelledby="policy-modal-title" aria-describedby="policy-modal-desc">
      <header>
        <h3 id="policy-modal-title">T√≠tulo</h3>
        <button id="policy-modal-close" aria-label="Cerrar">‚úï</button>
      </header>
      <div id="policy-modal-desc" class="content"></div>
    </article>

    <!-- Lightbox global -->
    <div class="lightbox" id="lightbox" role="dialog" aria-modal="true" aria-label="Imagen ampliada">
      <div class="inner">
        <button class="close" type="button" id="lbClose" aria-label="Cerrar">‚úï</button>
        <img id="lbImg" src="" alt="Imagen ampliada" />
        <!-- üîπ NUEVO: panel de texto bajo la imagen -->
        <div class="caption" id="lbCaption" style="display:none;">
          <h3 id="lbTitle"></h3>
          <p id="lbText"></p>
        </div>
      </div>
    </div>

    <!-- L√ìGICA: Carruseles + Lightbox -->
    <script>
      /* ===== Util: prueba .jpg/.jpeg/.webp autom√°ticamente ===== */
      function setImgWithFallback(imgEl, basePathWithoutExt, onload) {
        const exts = [".jpg",".jpeg",".webp"];
        let i = 0;
        function tryNext(){
          if (i >= exts.length) return;
          const url = basePathWithoutExt + exts[i++];
          imgEl.onload = () => { imgEl.onload = null; onload && onload(); };
          imgEl.onerror = tryNext;
          imgEl.src = url;
        }
        tryNext();
      }

      /* ===== Normalizar enlaces de Google Drive a directo (lh3) ===== */
      function normalizeDriveUrl(u){
        if(!u) return u;
        try {
          const s = String(u).trim();
          // ya directo (lh3)
          if (/^https?:\/\/(?:lh3|lh\d)\.googleusercontent\.com\/d\//i.test(s)) return s;
          // /file/d/ID/(view|preview)...
          let m = s.match(/\/file\/d\/([a-zA-Z0-9_-]+)/);
          if (m && m[1]) return `https://lh3.googleusercontent.com/d/${m[1]}=w1600`;
          // .../d/ID/...
          m = s.match(/\/d\/([a-zA-Z0-9_-]+)/);
          if (m && m[1]) return `https://lh3.googleusercontent.com/d/${m[1]}=w1600`;
          // open?id=ID  o  uc?id=ID  o  ?id=ID
          m = s.match(/[?&](?:id|uc)=([a-zA-Z0-9_-]+)/);
          if (m && m[1]) return `https://lh3.googleusercontent.com/d/${m[1]}=w1600`;
          return s;
        } catch { return u; }
      }

      /* Probar si existe una imagen (cualquier extensi√≥n com√∫n) */
      function probeBaseExists(basePathWithoutExt, cb) {
        const exts = [".jpg",".jpeg",".webp"];
        let i = 0;
        function tryNext(){
          if (i >= exts.length) { cb(false); return; }
          const url = basePathWithoutExt + exts[i++];
          const im = new Image();
          im.onload = ()=> cb(true);
          im.onerror = tryNext;
          im.src = url;
        }
        tryNext();
      }

      (function(){
        /* ===== Lightbox ===== */
        const lb = document.getElementById('lightbox');
        const lbImg = document.getElementById('lbImg');
        const lbClose = document.getElementById('lbClose');
        const lbCaption = document.getElementById('lbCaption');
        const lbTitle = document.getElementById('lbTitle');
        const lbText = document.getElementById('lbText');

        // ‚¨áÔ∏è Extiendo para soportar t√≠tulo + texto (back-compatible con llamadas viejas)
        function openLB(src, alt, title, text){
          lbImg.src = src; lbImg.alt = alt || 'Imagen ampliada';
          if (title || text){
            lbTitle.textContent = title || '';
            lbText.textContent = text || '';
            lbCaption.style.display = 'block';
          } else {
            lbCaption.style.display = 'none';
            lbTitle.textContent = '';
            lbText.textContent = '';
          }
          lb.classList.add('open'); lb.setAttribute('aria-hidden','false'); lbClose.focus();
        }
        function closeLB(){
          lb.classList.remove('open'); lb.setAttribute('aria-hidden','true');
        }
        lbClose?.addEventListener('click', closeLB);
        lb?.addEventListener('click', (e)=>{ if(e.target === lb) closeLB(); });
        document.addEventListener('keydown', (e)=>{ if (e.key === 'Escape' && lb.classList.contains('open')) closeLB(); });

        /* üî∏ Logo ampliable */
        const logo = document.getElementById('logoImage');
        if (logo) {
          logo.addEventListener('click', ()=> openLB(logo.src, 'Logo del hotel'));
        }

        /* ===== Carrusel: hero ===== */
        const heroImgs = ["/img/hotel-1", "/img/hotel-2", "/img/hotel-3"]; // sin extensi√≥n
        const heroImgEl = document.getElementById('hero-img');
        const heroDots = document.getElementById('hero-dots');
        let hi = 0;
        function renderHeroDots(){
          heroDots.innerHTML = "";
          heroImgs.forEach((_, idx) => {
            const d = document.createElement('div');
            d.className = 'dot' + (idx===hi ? ' active':'');
            d.addEventListener('click', ()=>showHero(idx));
            heroDots.appendChild(d);
          });
        }
        function showHero(idx){
          hi = (idx + heroImgs.length) % heroImgs.length;
          setImgWithFallback(heroImgEl, heroImgs[hi], renderHeroDots);
        }
        document.getElementById('hero-prev').addEventListener('click', ()=>showHero(hi-1));
        document.getElementById('hero-next').addEventListener('click', ()=>showHero(hi+1));
        heroImgEl.addEventListener('click', ()=> openLB(heroImgEl.src, 'Hotel'));
        showHero(0);
        /* üü¢ NUEVO: Auto-rotaci√≥n cada 5 segundos (loop infinito) */
        setInterval(()=>showHero(hi+1), 5000);

        /* ===== Carrusel: lobby (auto-agrega lobby-2 si existe) ===== */
        const lobbyBaseList = ["/img/lobby"]; // base sin extensi√≥n
        const lobbyImgEl = document.getElementById('lobby-img');
        const lobbyDots = document.getElementById('lobby-dots');
        let li = 0;

        function renderLobbyDots(){
          lobbyDots.innerHTML = "";
          lobbyBaseList.forEach((_, idx) => {
            const d = document.createElement('div');
            d.className = 'dot' + (idx===li ? ' active':'' );
            d.addEventListener('click', ()=>showLobby(idx));
            lobbyDots.appendChild(d);
          });
        }
        function showLobby(idx){
          li = (idx + lobbyBaseList.length) % lobbyBaseList.length;
          setImgWithFallback(lobbyImgEl, lobbyBaseList[li], renderLobbyDots);
        }
        document.getElementById('lobby-prev').addEventListener('click', ()=>showLobby(li-1));
        document.getElementById('lobby-next').addEventListener('click', ()=>showLobby(li+1));
        lobbyImgEl.addEventListener('click', ()=> openLB(lobbyImgEl.src, 'Lobby'));

        // inicial
        showLobby(0);
        /* üü¢ NUEVO: Auto-rotaci√≥n cada 5 segundos (loop infinito) */
        setInterval(()=>showLobby(li+1), 5000);

        // üî∏ si existe /img/lobby-2.(jpg|jpeg|webp), se agrega autom√°ticamente
        probeBaseExists("/img/lobby-2", (exists) => {
          if (exists) {
            lobbyBaseList.push("/img/lobby-2");
            renderLobbyDots();
          }
        });

        // Exponer openLB global para usarlo desde otras secciones (rooms)
        window.__openLB = openLB;
      })();
    </script>

    <!-- L√ìGICA DE HABITACIONES (intacta + integraci√≥n Reserva r√°pida + Ver habitaci√≥n) -->
    <script>
      (function(){
        // Orden visual
        const wantedNames = ["Suite premium","Simple est√°ndar","Simple est√°ndar","Doble est√°ndar"];

        // Base de im√°genes (el script intentar√° .jpg/.jpeg/.webp)
        const imageBaseMap = {
          "Suite premium": "suite-premium",
          "Simple est√°ndar": ["simple-estandar-1","simple-estandar-2"],
          "Doble est√°ndar": "doble-estandar"
        };
        const imagePickCount = {};

        const grid = document.getElementById('rooms-grid');
        const tpl  = document.getElementById('room-card-template');
        const err  = document.getElementById('rooms-error');

        const normalized = (s)=> String(s||'').toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').trim();

        function pickBase(name){
          const v = imageBaseMap[name];
          if (!v) return null;
          if (Array.isArray(v)) {
            const used = imagePickCount[name] || 0;
            imagePickCount[name] = used + 1;
            return v[used % v.length];
          }
          return v;
        }

        function setImgWithFallbackRoom(imgEl, base) {
          const exts = [".jpg",".jpeg",".webp"];
          let i = 0;
          function tryNext(){
            if (i >= exts.length) {
              // Fallback final remoto
              imgEl.src = "https://images.unsplash.com/photo-1551776235-dde6d4829808?q=80&w=1200&auto=format&fit=crop";
              return;
            }
            imgEl.onerror = () => { i++; tryNext(); };
            imgEl.src = "img/" + base + exts[i];
          }
          tryNext();
        }

        function formatPrice(v, curr){
          if(!(Number.isFinite(v) && v>0)) return null;
          try { return new Intl.NumberFormat('es-AR', { style: 'currency', currency: (curr||'USD') }).format(v); }
          catch { return (curr||'USD') + " " + v; }
        }

        /* ===== Apertura del chat y navegaci√≥n al flujo de RESERVA ===== */

        // Mantengo helpers existentes como fallback:
        function openChatFast() {
          try { if (window.ChatWidget && typeof window.ChatWidget.open === 'function') window.ChatWidget.open(); } catch(e){}
          const launcher = document.querySelector('#chat-widget-launcher, [data-cw="launcher"], .cw-launcher, button[aria-label="Asistente personal"]');
          if (launcher) { try { launcher.click(); } catch(e){} }
          const buttons = Array.from(document.querySelectorAll('button, a, div[role="button"]'));
          const cand = buttons.find(b => (b.innerText||'').toLowerCase().includes('asistente personal'));
          if (cand) { try { cand.click(); } catch(e){} }
        }

        function tryClickReserveButton() {
          const selectors = ['button','a','[role="button"]','.cw-chip','.cw-menu button','.cw-menu a'];
          const labels = ['hacer una reserva','reservar','reserva','book now','book','make a reservation'];
          for (const sel of selectors) {
            const nodes = document.querySelectorAll(sel);
            for (const n of nodes) {
              const t = (n.innerText || n.textContent || '').trim().toLowerCase();
              if (!t) continue;
              if (labels.some(lbl => t.includes(lbl))) {
                try { (n).click(); return true; } catch {}
              }
            }
          }
          return false;
        }

        function sendToChat(text){
          const start = performance.now();
          function tryNow(){
            const input = document.querySelector('#cw-text, #cw-input, [data-cw="input"], .cw-input textarea, .cw-input input, textarea, input[type="text"]');
            if (input && input.offsetParent !== null) {
              input.focus();
              input.value = text;
              input.dispatchEvent(new Event('input', {bubbles:true}));
              const sendBtn = document.querySelector('#cw-send, [data-cw="send"], .cw-send, button[type="submit"]');
              if (sendBtn) { try { sendBtn.click(); } catch(e){} }
              else { input.dispatchEvent(new KeyboardEvent('keydown', {key:'Enter', bubbles:true})); }
              return true;
            }
            if (performance.now() - start < 2200) { requestAnimationFrame(tryNow); return false; }
            window.postMessage({ type:'CW_PREFILL', text }, '*');
            return false;
          }
          tryNow();
        }

        // >>> ACTUALIZADO: usa la API del widget (Reserva r√°pida) y conserva fallback
        function launchReservation(roomName, priceFmt){
          // 1) Intento oficial: abrir panel + Reserva r√°pida con habitaci√≥n preseleccionada
          try {
            if (window.ChatWidget && typeof window.ChatWidget.startPreselected === 'function') {
              window.ChatWidget.startPreselected(roomName);
              return; // √©xito: no hace falta fallback
            }
          } catch(e){ /* contin√∫a al fallback */ }

        // 2) Fallback: abrir chat, intentar ‚ÄúHacer una reserva‚Äù por UI/texto
          openChatFast();

          let clicked = false;
          const t0 = performance.now();
          const spinClick = () => {
            if (!clicked) clicked = tryClickReserveButton();
            if (!clicked && performance.now() - t0 < 1000) requestAnimationFrame(spinClick);
          };
          spinClick();

          setTimeout(() => { if (!clicked) sendToChat('Hacer una reserva'); }, 350);

          const humanMsg = `Seleccion√© la habitaci√≥n "${roomName}"${priceFmt ? ` por ${priceFmt} por noche` : ''}.`;
          const setRoom  = `Habitaci√≥n: ${roomName}`;
          const askDates = `Continuemos con mi reserva. Por favor, pedime: fecha de entrada, fecha de salida (o cantidad de noches), mi nombre completo, email y tel√©fono.`;
          setTimeout(()=> sendToChat(humanMsg), 550);
          setTimeout(()=> sendToChat(setRoom),   800);
          setTimeout(()=> sendToChat(askDates), 1050);
        }

        /* ===== Helpers de ficha ===== */

        function normalizeAmenities(v){
          if (!v) return '';
          if (Array.isArray(v)) return v.map(x=>String(x).trim()).filter(Boolean).join(' ¬∑ ');
          const s = String(v);
          if (s.includes('¬∑')) return s.replace(/\s*¬∑\s*/g,' ¬∑ ').trim();
          if (s.includes('\n')) return s.split('\n').map(x=>x.trim()).filter(Boolean).join(' ¬∑ ');
          if (s.includes(',')) return s.split(',').map(x=>x.trim()).filter(Boolean).join(' ¬∑ ');
          return s.trim();
        }

        function openRoomDetails(roomName, imageUrl, amenitiesText){
          const title = roomName || 'Habitaci√≥n';
          const text  = amenitiesText || 'Informaci√≥n disponible en recepci√≥n.';
          const alt   = `Foto de ${title}`;
          const src   = imageUrl || 'https://images.unsplash.com/photo-1551776235-dde6d4829808?q=80&w=1200&auto=format&fit=crop';
          // usa el lightbox global extendido
          if (window.__openLB) window.__openLB(src, alt, title, text);
        }

        /* ===== Construcci√≥n de tarjetas desde Sheets ===== */

        fetch('/api/web/rooms')
          .then(r => r.json())
          .then(({ok, rooms}) => {
            if(!ok) throw new Error('rooms_api');
            const list = Array.isArray(rooms) ? rooms : [];

            // üîß FIX duplicados:
            // Agrupo por nombre normalizado y consumo en orden (shift) para que
            // si ‚ÄúSimple est√°ndar‚Äù aparece dos veces, tome dos filas distintas.
            const groups = {};
            const norm = (x)=> normalized(x?.name);
            for (const r of list) {
              const key = norm(r);
              if (!key) continue;
              if (!groups[key]) groups[key] = [];
              groups[key].push(r);
            }

            const chosen = [];
            for (const desired of wantedNames) {
              const key = normalized(desired);
              const r = (groups[key] && groups[key].length) ? groups[key].shift() : null;
              chosen.push(r || { name: desired, basePrice: null, currency: 'USD' });
            }
            // üîß FIN FIX duplicados

            const grid = document.getElementById('rooms-grid');
            const tpl  = document.getElementById('room-card-template');

            grid.innerHTML = '';
            chosen.slice(0,4).forEach((r, idx) => {
              const node = document.importNode(tpl.content, true);
              const card = node.querySelector('.room');
              const imgWrap = node.querySelector('.img-wrap');
              const overlay = node.querySelector('.overlay');
              const img  = node.querySelector('img');
              const nm   = node.querySelector('.room-name');
              const pill = node.querySelector('.room-price');
              const badge= node.querySelector('.badge-price');
              const btn  = node.querySelector('.btn-reserve');
              const btnView = node.querySelector('.btn-view');

              const wantedNameOriginal = wantedNames[idx];
              const roomName = r.name || wantedNameOriginal || 'Habitaci√≥n';
              const priceFmt = formatPrice(Number(r.basePrice ?? r.price ?? r.precio ?? r.PRECIO_BASE), r.currency || r.moneda);

              nm.textContent   = roomName;
              pill.textContent = priceFmt ? ('desde ' + priceFmt) : 'consultar';
              badge.textContent= priceFmt ? (priceFmt + ' / noche') : 'Consultar precio';

              // ========= ASIGNACI√ìN DE IMAGEN (intacta) =========
              const imageFromSheets =
                r.imageUrl || r.image || r.image_url || r.IMAGEN_URL || r.IMAGEN || r.FOTO || r.photo || r.foto;

              const baseLocal = pickBase(wantedNameOriginal);

              if (imageFromSheets) {
                const normalizedUrl = normalizeDriveUrl(imageFromSheets);
                img.src = normalizedUrl;
                img.onerror = () => {
                  if (baseLocal) setImgWithFallbackRoom(img, baseLocal);
                  else img.src = "https://images.unsplash.com/photo-1551776235-dde6d4829808?q=80&w=1200&auto=format&fit=crop";
                };
              } else if (baseLocal) {
                setImgWithFallbackRoom(img, baseLocal);
              } else {
                img.src = "https://images.unsplash.com/photo-1551776235-dde6d4829808?q=80&w=1200&auto=format&fit=crop";
              }
              // =========================================

              // Servicios / amenities desde Sheets
              const amenitiesText = normalizeAmenities(r.amenities || r.SERVICIOS || r.features || r.FEATURES);

              // === Acciones ===
              const handleReserve = (ev) => { ev?.preventDefault?.(); launchReservation(roomName, priceFmt); };
              btn.addEventListener('click', handleReserve);
              overlay.addEventListener('click', handleReserve);
              imgWrap.addEventListener('click', handleReserve);
              imgWrap.addEventListener('keydown', (e)=>{ if (e.key === 'Enter' || e.key === ' ') handleReserve(e); });

              // üîπ Ver habitaci√≥n: solo foto + servicios (sin abrir chat)
              btnView.addEventListener('click', (e)=> {
                e.preventDefault();
                e.stopPropagation();
                e.stopImmediatePropagation();
                openRoomDetails(roomName, img.src, amenitiesText);
              });

              grid.appendChild(node);
            });
          })
          .catch(() => { err.style.display = 'block'; });
      })();
    </script>

    <!-- Chat dock a la derecha (NO TOCAR) -->
    <script src="chat-widget.js" defer></script>

    <!-- üü¢ NUEVO: Bot√≥n fijo centrado inferior -> abre la simulaci√≥n en nueva pesta√±a -->
    <a href="chat-simulacion.html" target="_blank" rel="noopener" id="simulate-fab" aria-label="Comenzar simulaci√≥n">
      Comenzar simulaci√≥n
    </a>

    <!-- üîµ NUEVO: L√≥gica del bot√≥n hamburguesa / drawer + construcci√≥n din√°mica desde politicas.html -->
    <script>
      (function(){
        const btn = document.getElementById('policy-btn');
        const drawer = document.getElementById('policy-drawer');
        const backdrop = document.getElementById('policy-backdrop');
        const closeBtn = document.getElementById('policy-close');

        const list = document.getElementById('policy-list');
        const mBackdrop = document.getElementById('policy-modal-backdrop');
        const modal = document.getElementById('policy-modal');
        const mClose = document.getElementById('policy-modal-close');
        const mTitle = document.getElementById('policy-modal-title');
        const mDesc  = document.getElementById('policy-modal-desc');

        function openDrawer(){
          drawer.classList.add('open');
          backdrop.classList.add('open');
          btn.setAttribute('aria-expanded','true');
          backdrop.setAttribute('aria-hidden','false');
          setTimeout(()=> closeBtn.focus(), 50);
        }
        function closeDrawer(){
          drawer.classList.remove('open');
          backdrop.classList.remove('open');
          btn.setAttribute('aria-expanded','false');
          backdrop.setAttribute('aria-hidden','true');
          btn.focus();
        }

        btn?.addEventListener('click', openDrawer);
        closeBtn?.addEventListener('click', closeDrawer);
        backdrop?.addEventListener('click', closeDrawer);
        document.addEventListener('keydown', (e)=>{ if (e.key === 'Escape' && drawer.classList.contains('open')) closeDrawer(); });

        // ========= Modal =========
        function openModal(title, html){
          mTitle.textContent = title || 'Detalle';
          mDesc.innerHTML = html || '<p>Sin contenido.</p>';
          mBackdrop.classList.add('open');
          modal.classList.add('open');
          setTimeout(()=> mClose.focus(), 20);
        }
        function closeModal(){
          mBackdrop.classList.remove('open');
          modal.classList.remove('open');
        }
        mBackdrop.addEventListener('click', closeModal);
        mClose.addEventListener('click', closeModal);
        document.addEventListener('keydown', (e)=>{ if (e.key === 'Escape' && modal.classList.contains('open')) closeModal(); });

        // ========= Construcci√≥n desde /politicas.html =========
        function normalize(s){
          return String(s||'').toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').trim();
        }
        function pesoCategoria(t){
          const s = normalize(t);
          if (/(privacidad|datos personales|proteccion de datos)/.test(s)) return 10;
          if (/(cookies?)/.test(s)) return 20;
          if (/(cancelaci[o√≥]n|reembolso|no[- ]?show)/.test(s)) return 30;
          if (/(pagos?|facturaci[o√≥]n|tarifas)/.test(s)) return 40;
          if (/(responsabilidad|disclaimer|limitaci[o√≥]n)/.test(s)) return 50;
          if (/(terminos|condiciones)/.test(s)) return 60;
          return 70;
        }

        function extraerSecciones(doc){
          // Tomamos headings del body
          const headings = Array.from(doc.querySelectorAll('h1,h2,h3'));
          if (!headings.length){
            return [{ title: 'Pol√≠ticas (versi√≥n completa)', html: (doc.body?.innerHTML || '').trim() }];
          }
          const bodyNodes = Array.from(doc.body.childNodes);
          const sections = [];
          let current = null, currentLevel = 10;

          function start(title, level){
            current = { title: title?.trim() || 'Secci√≥n', html: '' };
            currentLevel = level;
            sections.push(current);
          }

          for (const node of bodyNodes){
            if (node.nodeType === Node.ELEMENT_NODE && /^(H1|H2|H3)$/.test(node.nodeName)){
              const level = Number(node.nodeName.substring(1));
              start(node.textContent, level);
              continue;
            }
            if (!current) start('Introducci√≥n', 3);
            current.html += node.outerHTML ? node.outerHTML : (node.textContent || '');
          }

          // Limpieza
          return sections
            .map(s => ({ title: s.title, html: (s.html || '').trim() }))
            .filter(s => s.html && s.html.replace(/<[^>]+>/g,'').trim().length);
        }

        function construirLista(secciones){
          list.innerHTML = '';
          // Ordenar por categor√≠a ‚Äúl√≥gica‚Äù y luego alfab√©tico
          secciones
            .map(s => ({...s, weight: pesoCategoria(s.title)}))
            .sort((a,b)=> (a.weight - b.weight) || a.title.localeCompare(b.title))
            .forEach((s, idx) => {
              const btn = document.createElement('button');
              btn.type = 'button';
              btn.className = 'pitem';
              btn.setAttribute('role', 'listitem');
              btn.innerHTML = `<span class="ptitle">${s.title}</span><span class="badge">${idx+1}</span>`;
              btn.addEventListener('click', ()=> openModal(s.title, s.html));
              list.appendChild(btn);
            });

          if (!list.childElementCount){
            const empty = document.createElement('div');
            empty.className = 'pitem';
            empty.innerHTML = '<span class="ptitle">No se encontraron secciones en politicas.html</span>';
            list.appendChild(empty);
          }
        }

        function construirDesdePoliticas(){
          fetch('politicas.html', { credentials:'same-origin' })
            .then(r => r.text())
            .then(html => {
              const parser = new DOMParser();
              const doc = parser.parseFromString(html, 'text/html');
              const secciones = extraerSecciones(doc);
              construirLista(secciones);
            })
            .catch(() => {
              list.innerHTML = `
                <div class="pitem"><span class="ptitle">No se pudo cargar /politicas.html</span></div>
                <div class="pitem"><span class="ptitle">Ver documento completo</span></div>`;
              // Si quer√©s, podr√≠amos enlazar al PDF aqu√≠, pero me pediste sin iframes.
            });
        }

        // Construir lista apenas cargue el DOM (y tambi√©n al abrir el drawer por si el archivo cambia)
        if (document.readyState === 'loading'){
          document.addEventListener('DOMContentLoaded', construirDesdePoliticas, { once:true });
        } else {
          construirDesdePoliticas();
        }
        btn.addEventListener('click', construirDesdePoliticas);
      })();
    </script>
  </body>
</html>
